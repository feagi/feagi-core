[package]
authors.workspace = true
name = "feagi-io"
version.workspace = true
edition = "2021"
license = "Apache-2.0"
description = "FEAGI I/O System - Agent I/O, registration, ZMQ & SHM"

[features]
default = ["zmq-transport", "udp-transport"]  # Most deployments need both
zmq-transport = ["dep:zmq"]                   # Blocking, TCP-based transport
udp-transport = ["dep:tokio", "dep:async-trait", "dep:num_cpus"]  # Async, best-effort transport
shm-transport = []                            # Shared memory (no extra deps, future)
websocket-transport = ["udp-transport", "dep:tokio-tungstenite", "dep:futures-util"]  # WebSocket requires tokio, tungstenite, futures
all-transports = ["zmq-transport", "udp-transport", "shm-transport", "websocket-transport"]
connectome-serialization = ["bincode", "connectome-compression"]  # Connectome file I/O (types in feagi-npu-neural)
connectome-compression = []  # LZ4 compression for connectome files (lz4 already in dependencies)

[dependencies]
feagi-npu-burst-engine = { version = "0.0.1-beta.2", path = "../feagi-npu/burst-engine" }
feagi-brain-development = { version = "0.0.1-beta.2", path = "../feagi-brain-development" }  # For CorticalAreaExt
feagi-services = { version = "0.0.1-beta.2", path = "../feagi-services" }  # For GenomeService and ConnectomeService
feagi-npu-neural = { version = "0.0.1-beta.2", path = "../feagi-npu/neural" }  # For types
# FEAGI data structures and serialization (for binary XYZP format)
feagi-data-structures.workspace = true
feagi-data-serialization = { workspace = true }

# Core dependencies (always required)
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
anyhow = "1.0"
base64 = "0.22"
crossbeam = "0.8"
parking_lot = "0.12"
ahash.workspace = true
thiserror = "1.0"
lz4 = "1.28"  # LZ4 compression (used by multiple transports)
tracing = { workspace = true }  # Structured logging

# Connectome serialization dependencies (optional, behind feature)
bincode = { version = "1.3", optional = true }  # Fast binary serialization

# Optional transport-specific dependencies (consolidated from feagi-transports)
zmq = { version = "0.10", optional = true }  # ZMQ transport
tokio = { version = "1.0", features = ["full"], optional = true }  # Async runtime (UDP, WebSocket)
async-trait = { version = "0.1", optional = true }  # Async traits
num_cpus = { version = "1.16", optional = true }  # CPU detection for UDP
tokio-tungstenite = { version = "0.21", optional = true }  # WebSocket transport
futures-util = { version = "0.3", optional = true }  # WebSocket utilities

[dev-dependencies]
tokio-test = "0.4"
tempfile = "3.8"  # For connectome serialization tests

[lib]
name = "feagi_io"
path = "src/lib.rs"

